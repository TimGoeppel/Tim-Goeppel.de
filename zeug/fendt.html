<!DOCTYPE html>
<html lang="de">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fendt | Tim-Goeppel.de</title>
	<meta name="author" content="Tim Göppel">
	<meta name="description" content="Fendt">
	<meta property="og:title" content="Tim Göppel">
	<meta property="og:description" content="Fendt">
	<script type="text/javascript" src="p5.min.js"></script>
	<script type="text/javascript">
		var fall = 10;
		const fendt = {
			x: 0,
			y: 0,
			jump: 0,
			speed: 8,
			image: 0
		};
		const terrain = {
			data: [],
			width: 5,
			getAt: function (xCoord) {
				const index = this.toIndex(xCoord);
				let t = this.data[index];
				if (!t) {
					t = (noise(xCoord / this.width / 100) + 1) * (height / 2);
					this.data[index] = t;
				}
				return t;
			},
			toIndex: function (xCoord) {
				return floor((xCoord < 0 ? 1 - (xCoord * 2) : xCoord * 2) / this.width);
			},
			toXCoord: function (index) {
				return (index % 2 ? (1 - index) / 2 : index / 2) * this.width;
			}
		};
		const images = ["fendt.png", "fendtabgase.png", "fendtregenbogen.png"];
		const titleSize = [50, 0];

		function setup() {
			createCanvas(window.innerWidth - 20, window.innerHeight - 20);
			for(let i = 0; i < images.length; i++) {
				images[i] = loadImage(images[i]);
			}
			fill(0);
			textSize(titleSize[0]);
			titleSize[1] = textWidth("Fendt Simulator");
			imageMode(CENTER);
			ellipseMode(CORNER);
		}

		function draw() {
			background(255);
			text("Fendt Simulator", 0, titleSize[0]);
			if(fendt.image == 1 || fendt.image == 2) {
				textSize(5);
				fill(150);
				text("Bildquellen: https://i.pinimg.com/originals/02/63/cb/0263cb36adc2fbb5433e26b2b12ee3ee.png; https://i.pinimg.com/originals/02/63/cb/0263cb36adc2fbb5433e26b2b12ee3ee.png", 0, height - 6); 
				fill(0);
				textSize(titleSize[0]);
			}
			const deltaX = Math.min(fendt.speed, Math.max(-fendt.speed, mouseX - width / 2));
			let ground = getGround(fendt.x + deltaX);
			if ((ground + 5) >= fendt.y) {
				fendt.x += deltaX;
				fendt.y = Math.min(ground, fendt.y);
			}
			ground = getGround(fendt.x);
			if (fendt.y < ground) {
				// Entschuldigung
				fendt.y = Math.min(fendt.y + fall, ground);
			}
			if (fendt.jump > 0) {
				fendt.y -= fendt.jump--;
			}
			drawBackground();
			if (deltaX > 0) {
				scale(-1, 1);
				image(images[fendt.image], -width / 2, fendt.y - 81, 300, 162);
			} else {
				image(images[fendt.image], width / 2, fendt.y - 81, 300, 162);
			}
		}

		function getGround(xCoord) {
			return Math.min(terrain.getAt(xCoord - 81), terrain.getAt(xCoord), terrain.getAt(xCoord + 81));
		}

		function performJump() {
			if (fendt.y >= getGround(fendt.x)) fendt.jump = 25;
		}

		function keyPressed() {
			if (key == " ") performJump();
		}

		function mousePressed() {
			if(mouseX > 0 && mouseX < titleSize[1] && mouseY > 0 && mouseY < (titleSize[0] * 1.5)) {
				fendt.image = (fendt.image == (images.length - 1)) ? 0 : fendt.image + 1;
			} else performJump();
		}

		function drawBackground() {
			for (let i = -width / 2; i < (width / 2); i += terrain.width) {
				const h = terrain.getAt(i + fendt.x);
				fill(0);
				stroke(0);
				rect(i + width / 2, h, terrain.width, h); // TODO: Perhaps not use rectangles here because it looks a bit ugly
			}
		}

	</script>
</head>

<body>

</body>

</html>
